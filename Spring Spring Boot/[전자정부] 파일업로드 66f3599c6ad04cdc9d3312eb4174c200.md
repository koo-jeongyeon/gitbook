# [전자정부] 파일업로드

생성일: 2021년 1월 14일 오후 3:06

```java
요약설명
-셋팅
-폼뷰용 컨트롤러와, 뷰
-업로드컨트롤러
-업로드시에 필요하다면 쿼리

-------------------

1.src> main > webapp > web-inf > config >egovframework>sprignmvc > dispatcher-servlet.xml
 
 아래 내용 추가.
   <bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"/>
 
2. 디펜던시 추가 - pom.xml
      <dependency>
   <groupId>commons-fileupload</groupId>
   <artifactId>commons-fileupload</artifactId>
    <version>1.3.1</version>
</dependency>
 
3.컨트롤러에
 파일 업로드 루틴 셋팅
 
 파일처리용 리소스 셋팅
@Resource(name= "multipartResolver")
    CommonsMultipartResolver multipartResolver;
 
4.폼 뷰만들기
<form  method="post" action="/test48/test/TestUpload.do"    enctype="multipart/form-data">
   <input type=file name=myfile>
   <input type=submit>
</form>         
4-1.  폼뷰용 컨트롤러도 만들어야 함
 
 
5.파일 업로드 컨트롤러.
   @RequestMapping(value ="/TestUpload.do")
    public String TestUpload(  HttpServletRequest request,Model model )throws Exception {
     System.out.println("testupload.do");
 
      String fileName  = FileUpload(request); // <=== 파일업로드용 연결..
 
	in.put("img", fileName);
       return "testform";
   }
 
------------------------------------
jsp파일
 <img src="/kvalue/mcsad/${ data.img}" />
 
 파일 업로드 루틴 셋팅  
     
     String FileUpload(HttpServletRequest request )throws Exception{
         System.out.println("FileUpload");
           final MultipartHttpServletRequest multiRequest = (MultipartHttpServletRequest) request; // 1. 리퀘스트를 멀티파트리퀘스트로 형변환 
           System.out.println("FileUpload10");  
           final Map<String, MultipartFile> files = multiRequest.getFileMap(); //2.파일정보들 배열화
           System.out.println("FileUpload11");   
//           Assert.notNull(files, "files is null"); //에러체크   , 파일이 무조건 있다 가정하고 에러체크 패스함..
//           Assert.state(files.size() > 0, "0 files exist");
            
//           String uploadPath = "C:\\Program Files\\Apache Software Foundation\\Tomcat 9.0\\webapps\\SC";    
//           String uploadPath = "./down";     //3. 파일이 저장될 서버 폴더 경로
           
           ServletContext sct = request.getSession().getServletContext();
           System.out.println("FileUpload12");
           String rootPath = sct.getRealPath("/");
           System.out.println("FileUpload13");
           File pt = new File(rootPath+"..");
           System.out.println("FileUpload14");
           String uploadPath = pt.getCanonicalPath()+"\\fmplife\\mcsad";
           System.out.println("FileUpload15");
           File saveFolder = new File(uploadPath); //파일업로드폴더지정
           
           System.out.println("FileUpload2");
           
           // 디렉토리 생성
           if (!saveFolder.exists() || saveFolder.isFile()) { //4.  해당 경로 파일이 서버에 폴더가 없으면 폴더 생성
              saveFolder.mkdirs();
              System.out.println("FileUpload3");
           }
           
           System.out.println("FileUpload4");
           Iterator<Entry<String, MultipartFile>> itr = files.entrySet().iterator(); //5. 파일목록을 액세스하기 편하게 이터레이터로 변환
           MultipartFile file;
           String filePath;
           String fn="";
           while (itr.hasNext()) { // 6. 파일갯수만큼 반복 작업 .
              Entry<String, MultipartFile> entry = itr.next();//7. 파일목록중에서 현제 차례 파일 한개 가져옴
              System.out.println("FileUpload5");
              file = entry.getValue(); // 8.파일 이름 데이타 얻기
              if (!"".equals(file.getOriginalFilename())) { //빈파일인지 체크
                 filePath = uploadPath + "\\" + file.getOriginalFilename(); // 9.파일이름에 경로디렉토리를 추가하여 풀패스 설정
                 File af = new File(filePath);
 
                 file.transferTo(af);  // 10. 임시로 업로드된 파일을 실제 서버로 이동
                 System.out.println("FileUpload6");
                 fn = file.getOriginalFilename() ; // 파일이름을 나중에 엑세스 하기 위하여 저장, DB에 저장하거나 디버깅용으로 출력해보거너 할때 사용하면됨.     
                 System.out.println("FileUpload7");
              }
           }
          return fn;
       }
```